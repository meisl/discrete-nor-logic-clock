<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE script:module PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "module.dtd">
<script:module xmlns:script="http://openoffice.org/2000/script" script:name="M00_Common" script:language="StarBasic">REM  *****  BASIC  *****

Type TTest_NoTyname

End Type

Type TTest_Tyname
	tyname As String
End Type

Type TTestPass
	n As Integer
	x As String
End Type

Type TTestFail
	n As Integer
	expected As Variant
	actual As Variant
End Type

Sub Main
	test_Common()
End Sub


Function typeOf(x As Variant)
	Dim result As String
	result = TypeName(x)
	If result = &quot;Object&quot; Then
		result = _typeOf(x)
	End If
	typeOf = result
End Function

Function _typeOf(o As Object)
	Dim result As String
	result = &quot;Object&quot;
	On Local Error Goto ErrorHandler
	result = result &amp; &quot;/&quot; &amp; o.tyname
ErrorHandler:
	_typeOf = result
End Function

Sub croak(msg As String)
	Dim provoke As Object
	MsgBox(msg)
	MsgBox(provoke.AnError)
End Sub

Function fst(x As Variant, y As Variant)
	fst = x
End Function

Function snd(x As Variant, y As Variant)
	snd = y
End Function

Function concat(a As String, b As String) As String
	concat = a &amp; b
End Function

Function assertEqual(actual As Variant, expected As Variant)
	Dim result As Object
	If Not(actual = expected) Then
		Set result = New TTestFail
		result.expected = expected
		result.actual = actual
		MsgBox(&quot;FAIL: expected &quot; &amp; toString(actual) &amp; chr(13) &amp; &quot;     to equal &quot; &amp; toString(expected))
		assertEqual = result
	Else
		Set result = New TTestPass
	End If
	assertEqual = result
End Function

Function toString(ByVal x As Variant) As String
	Dim result As String
	If IsNull(x) Then
		result = &quot;Nothing&quot;
	ElseIf IsEmpty(x) Then
		result = &quot;Empty&quot;
	ElseIf IsArray(x) Then
		result = &quot;Array(&quot;
		Dim i As Integer
		For i = LBound(x) To UBound(x)
			If i &gt; LBound(x) Then
				result = result &amp; &quot;, &quot;
			End If
			result = result &amp; toString(x(i))
		Next i
		result = result &amp; &quot;)&quot;
	ElseIf IsObject(x) Then
		result = &quot;Object&quot;
	Else
		Dim t As String
		t = x &amp; &quot;&quot;
		t = Join(Split(t, chr(13)), &quot;\n&quot;)
		t = Join(Split(t, chr(9)), &quot;\t&quot;)
		If TypeName(x) = &quot;String&quot; Then
			result = &quot;&apos;&quot; &amp; t &amp; &quot;&apos;&quot;
		Else
			result = t
		End If
	End If
	toString = result
End Function

&apos;= tests ============================================================

Function test_Common()
	assertEqual(typeOf(0), &quot;Integer&quot;).x
	assertEqual(typeOf(1), &quot;Integer&quot;).x
	assertEqual(typeOf(-42), &quot;Integer&quot;).x
	
	assertEqual(typeOf(&quot;&quot;), &quot;String&quot;).x
	assertEqual(typeOf(&quot;1&quot;), &quot;String&quot;).x
	
	assertEqual(typeOf(3.14), &quot;Double&quot;).x

&apos;	assertEqual(typeOf(Array()), &quot;Array&quot;).x

	assertEqual(typeOf(Empty), &quot;Empty&quot;).x
	assertEqual(typeOf(Nothing), &quot;Object&quot;).x

	Dim t1 As New TTest_NoTyName
	assertEqual(typeOf(t1), &quot;Object&quot;).x

	Dim t2 As New TTest_TyName
	t2.tyname = &quot;foobar&quot;
	assertEqual(typeOf(t2), &quot;Object/foobar&quot;).x

End Function

</script:module>